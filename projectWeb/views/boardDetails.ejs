<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Board Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/font.css">
    <link rel="icon" type="image/x-icon" href="/pic/apple-touch-icon.png" />
    <link rel="stylesheet" href="/css/styleDetail.css" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.th.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.34/moment-timezone-with-data.min.js"></script>
</head>

<body>
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light bg-white">
            <div class="container-fluid">
                <a class="navbar-brand" href="/home">
                    <img src="/pic/logo.png" alt="โลโก้โปรเจค" height="40" class="d-inline-block align-text-top"
                        style="filter: brightness(0) saturate(100%) invert(18%) sepia(95%) saturate(1644%) hue-rotate(182deg) brightness(94%) contrast(101%);">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a href="/" class="nav-link text-decoration-none fs-6 d-flex align-items-center"
                                style="color: #26648E;">
                                <i class="fas fa-chevron-left me-1"></i>
                                <span>หน้าหลัก</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="card shadow-lg rounded-4 border-0 mb-5">
            <div class="card-body p-3 p-md-5">
                <div class="d-flex justify-content-center align-items-center mb-4 mb-md-5">
                    <h1 class="h1 text-dark fw-bold text-center animate__animated animate__fadeInDown me-3 mb-0">
                        รายละเอียด : </h1>
                    <h1 id="currentName"
                        class="h1 text-dark fw-bold text-center animate__animated animate__fadeInDown me-3 mb-0">
                        <%= board.nameboard %>
                    </h1>
                    <i class="bi bi-pencil-square" data-bs-toggle="modal" data-bs-target="#changeNameModal"
                        style="cursor: pointer;"></i>
                </div>
                <div class="container p-3 p-md-4 bg-white rounded-4 mb-4 mb-md-5 shadow-sm">
                    <div class="row align-items-center mb-4">
                        <div class="col-12 d-flex justify-content-end align-items-center mb-3">
                            <button type="button"
                                class="btn btn-outline-danger btn-sm rounded-pill px-3 py-2 transition-all hover:bg-danger hover:text-white"
                                data-bs-toggle="modal" data-bs-target="#confirmDeleteModal-<%= board.id %>">
                                <i class="far fa-trash-can me-2"></i>ลบบอร์ด
                            </button>
                        </div>
                    </div>

                    <div class="bg-light p-3 p-md-4 rounded-4 mb-4 mb-md-5 animate__animated animate__fadeIn">
                        <div
                            class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                            <p
                                class="card-text mb-3 mb-md-0 d-flex flex-column flex-md-row align-items-start align-items-md-center">
                                <span class="fw-bold text-dark fs-4 me-0 me-md-3 mb-2 mb-md-0">รหัสตู้ปลา :</span>
                                <span id="tokenText" class="text-muted fs-5 me-0 me-md-3 mb-2 mb-md-0">
                                    <%= board.token %>
                                        <button id="copyButton" type="button"
                                            class="btn btn-link p-0 ms-2 text-secondary" onclick="copyToClipboard()">
                                            <i class="bi bi-clipboard"></i>
                                        </button>
                                </span>
                            </p>
                        </div>
                    </div>

                    <div class="row mb-4 mt-3 justify-content-center">
                        <div class="col-md-6">
                            <div
                                class="card bg-gradient-light rounded-4 shadow-lg animate__animated animate__fadeInUp hover:shadow-xl transition-all">
                                <div class="card-body p-4 position-relative text-center">
                                    <h3 class="card-title h4 mb-3 text-uppercase font-weight-bold">
                                        <strong>อุณหภูมิปัจจุบัน</strong>
                                    </h3>
                                    <h2 class="display-3 text-secondary fw-bold mb-4">
                                        <span id="currentTemperature"
                                            class="animate__animated animate__pulse animate__infinite">
                                            <%= board.new_temp %>
                                        </span>
                                        °C
                                    </h2>
                                    <button type="button"
                                        class="btn btn-lg rounded-pill shadow-sm animate__animated animate__fadeIn hover:shadow-md transition-all mb-3"
                                        style="background-color: #26648E; color: white;" data-bs-toggle="modal"
                                        data-bs-target="#changeGeneralTempModal">
                                        ปรับอุณหภูมิ
                                    </button>
                                    <p class="mb-0 text-danger text-end">** อุณหภูมิที่ตั้งค่าจะบวกลบประมาณ 0.5 °C</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4 mb-md-5">
                        <div class="col-12 col-md-6 mb-4 mb-md-0">
                            <div
                                class="card bg-light text-dark rounded-4 shadow-lg animate__animated animate__fadeInLeft hover:shadow-xl transition-all position-relative h-100">
                                <div class="card-body p-4 p-md-5">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <h3 class="card-title h4 mb-0 text-uppercase font-weight-bold">
                                            <strong>อุณหภูมิปัจจุบัน</strong>
                                        </h3>
                                        <i class="bi bi-thermometer-half text-warning fs-3"></i>
                                    </div>
                                    <h2 class="display-2 fw-bold mb-0 text-center text-warning"
                                        id="temp-display-<%= board.token %>">
                                        <strong>
                                            <%= board.temp %> °C
                                        </strong>
                                    </h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div
                                class="card bg-light text-dark rounded-4 shadow-lg animate__animated animate__fadeInRight hover:shadow-xl transition-all position-relative h-100">
                                <div class="card-body p-4 p-md-5">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <h3 class="card-title h4 mb-0 text-uppercase font-weight-bold"><strong>ค่า pH
                                                ปัจจุบัน</strong></h3>
                                        <i class="bi bi-droplet-half text-primary fs-3"></i>
                                    </div>
                                    <h2 class="display-2 fw-bold mb-0 text-center text-primary"
                                        id="ph-display-<%= board.token %>">
                                        <strong>
                                            <%= board.ph %>
                                        </strong>
                                    </h2>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal for Changing Name -->
                    <div class="modal fade" id="changeNameModal" tabindex="-1" aria-labelledby="changeNameModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content rounded-4 border-0 shadow-lg">
                                <div class="modal-header bg-light text-dark border-bottom">
                                    <h5 class="modal-title fw-bold" id="changeNameModalLabel">เปลี่ยนชื่อตู้ปลา</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body p-4 bg-white">
                                    <form id="changeNameForm" action="/updateName" method="POST">
                                        <input type="hidden" name="token" value="<%= board.token %>">
                                        <div class="mb-4">
                                            <label for="name"
                                                class="form-label fw-bold text-secondary">ชื่อใหม่ของตู้ปลา:</label>
                                            <input type="text" id="name" name="name"
                                                class="form-control form-control-lg bg-light"
                                                placeholder="<%= board.nameboard %>" required>
                                        </div>
                                        <button type="button" id="changeNameButton"
                                            class="btn btn-secondary btn-lg w-100 rounded-pill">บันทึก</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Change General Temperature Modal -->
                    <div class="modal fade" id="changeGeneralTempModal" tabindex="-1"
                        aria-labelledby="changeGeneralTempModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content rounded-4 border-0 shadow-lg">
                                <div class="modal-header bg-light text-dark border-bottom">
                                    <h5 class="modal-title fw-bold" id="changeGeneralTempModalLabel">
                                        ปรับอุณหภูมิ</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body p-4 bg-white">
                                    <form id="changeGeneralTempForm">
                                        <input type="hidden" name="token" value="<%= board.token %>">
                                        <div class="mb-4">
                                            <label for="generalTemp"
                                                class="form-label fw-bold text-secondary">อุณหภูมิที่ต้องการ
                                                (°C)</label>
                                            <input type="number" id="generalTemp" name="generalTemp"
                                                class="form-control form-control-lg bg-light"
                                                placeholder="<%= board.new_temp %>" required min="22" max="28">
                                        </div>
                                        <p class="mb-3 text-danger">** สามารถปรับอุณหภูมิได้ 24-28 °C</p>
                                        <button type="submit"
                                            class="btn btn-secondary btn-lg w-100 rounded-pill">บันทึก</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal ยืนยันการลบ -->
                    <div class="modal fade" id="confirmDeleteModal-<%= board.id %>" tabindex="-1"
                        aria-labelledby="confirmDeleteModalLabel-<%= board.id %>" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content border-0 shadow-lg rounded-4">
                                <div class="modal-header bg-danger text-white">
                                    <h5 class="modal-title font-weight-bold"
                                        id="confirmDeleteModalLabel-<%= board.id %>">
                                        ยืนยันการลบ</h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                        aria-label="ปิด"></button>
                                </div>
                                <div class="modal-body">
                                    <p class="mb-0">คุณแน่ใจหรือไม่ว่าต้องการลบบอร์ด <strong>
                                            <%= board.nameboard %>
                                        </strong>?</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary rounded-pill px-4"
                                        data-bs-dismiss="modal">ยกเลิก</button>
                                    <form action="/deleteboard" method="post">
                                        <input type="hidden" name="board_id" value="<%= board.id %>">
                                        <button type="submit" class="btn btn-danger rounded-pill px-4">ลบ</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Date Picker -->
                    <div class="container mt-4 mt-md-5 animate__animated animate__fadeIn">
                        <p class="mb-4 text-black" style="font-size: 1.5rem;">เลือกวันที่เพื่อดูข้อมูลของตู้ปลา <span
                                class="text-danger" style="font-size: 1rem;">** สามารถดูข้อมูลได้แบบย้อนหลัง</span></p>
                        <div class="input-group mb-4">
                            <input type="date" id="date-picker" class="form-control form-control-lg">
                            <button class="btn btn-primary" id="fetchDataBtn">ดูข้อมูลตู้ปลา</button>
                        </div>
                    </div>

                    <!-- ส่วนที่ซ่อนไว้ -->
                    <div id="hiddenContent" style="display: none;">
                        <!-- Graph Area -->
                        <div class="container mt-5 animate__animated animate__fadeIn">
                            <div class="card rounded-4 shadow-lg">
                                <div class="card-body p-4 p-md-5">
                                    <h2 class="card-title mb-4 fw-bold" style="font-size: 1.8rem;">
                                        ข้อมูลอุณหภูมิตู้ปลา
                                    </h2>
                                    <p class="text-muted mb-4" data-date style="font-size: 1.1rem;">
                                        วันที่ของข้อมูลชุดนี้</p>
                                    <div class="text-center mb-4">
                                        <span class="badge bg-secondary me-2 p-2" style="font-size: 1rem;">แกน X:
                                            เวลา</span>
                                        <span class="badge bg-secondary p-2" style="font-size: 1rem;">แกน Y:
                                            อุณหภูมิ
                                            (°C)</span>
                                    </div>
                                    <canvas id="temperatureChart" width="100%" height="60"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Add pH Chart -->
                        <div class="container mt-5 animate__animated animate__fadeIn">
                            <div class="card rounded-4 shadow-lg">
                                <div class="card-body p-4 p-md-5">
                                    <h2 class="card-title mb-4 fw-bold" style="font-size: 1.8rem;">ข้อมูล pH
                                        ในตู้ปลา
                                    </h2>
                                    <p class="text-muted mb-4" data-date style="font-size: 1.1rem;">
                                        วันที่ของข้อมูลชุดนี้</p>
                                    <div class="text-center mb-4">
                                        <span class="badge bg-secondary me-2 p-2" style="font-size: 1rem;">แกน X:
                                            เวลา</span>
                                        <span class="badge bg-secondary p-2" style="font-size: 1rem;">แกน Y:
                                            ค่า
                                            pH</span>
                                    </div>
                                    <canvas id="pHChart" width="100%" height="60"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="container mt-4 mt-md-5 animate__animated animate__fadeIn">
                            <div class="card rounded-4 shadow-sm">
                                <div class="card-body p-3 p-md-4">
                                    <h2 class="card-title mb-3 mb-md-4 fw-bold">ตารางข้อมูลตู้ปลา</h2>
                                    <p class="text-muted mb-3 mb-md-4" data-date>วันที่ของข้อมูลชุดนี้</p>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>วันที่</th>
                                                    <th>เวลา</th>
                                                    <th>อุณหภูมิตู้ปลา (°C)</th>
                                                    <th>pH ในตู้ปลา</th>
                                                </tr>
                                            </thead>
                                            <tbody id="data-table-body">
                                                <!-- ข้อมูลจะถูกเพิ่มที่นี่ -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bootstrap Toast for Success Messages for change name -->
                    <div id="successToast" class="toast position-fixed top-0 end-0 p-3" style="z-index: 1050;">
                        <div class="toast-header">
                            <strong class="me-auto">แจ้งเตือน</strong>
                            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                        <div class="toast-body">
                            อัปเดตอุณหภูมิสำเร็จ!
                        </div>
                    </div>

                    <!-- Bootstrap Toast for Success Messages for change name -->
                    <div id="successToast_ChangeName" class="toast position-fixed top-0 end-0 p-3"
                        style="z-index: 1050;">
                        <div class="toast-header">
                            <strong class="me-auto">แจ้งเตือน</strong>
                            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                        <div class="toast-body" id="toastMessage">เปลี่ยนชื่อสำเร็จ!</div>
                    </div>

                    <script>
                        document.getElementById('fetchDataBtn').addEventListener('click', function () {
                            document.getElementById('hiddenContent').style.display = 'block';
                        });
                    </script>
                </div>
            </div>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const generalTempForm = document.getElementById('changeGeneralTempForm');

                generalTempForm.addEventListener('submit', function (event) {
                    event.preventDefault();

                    const formData = new FormData(generalTempForm);
                    const token = formData.get('token');
                    const temp = formData.get('generalTemp');

                    if (temp === null || temp === '') {
                        alert('กรุณากรอกอุณหภูมิที่ถูกต้อง');
                        return;
                    }

                    fetch('/updateTemp', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ token, temp })
                    })
                        .then(response => {
                            if (response.ok) {
                                const currentTempElement = document.getElementById('currentTemperature');
                                if (currentTempElement) {
                                    currentTempElement.textContent = temp; // อัปเดตค่าอุณหภูมิ
                                } else {
                                    console.error('ไม่พบ element ที่ชื่อ currentTemperature');
                                }

                                // ซ่อน modal หลังจากส่งคำขอสำเร็จ
                                const modalElement = document.getElementById('changeGeneralTempModal');
                                const modalInstance = bootstrap.Modal.getInstance(modalElement);
                                if (modalInstance) {
                                    modalInstance.hide(); // ซ่อน modal ถ้ามี instance

                                    // แสดง Toast หลังจากโมดัลถูกซ่อน
                                    const toastEl = document.getElementById('successToast');
                                    const toast = new bootstrap.Toast(toastEl);
                                    toast.show(); // แสดง Toast
                                } else {
                                    console.error('ไม่พบ modal instance');
                                }
                            } else {
                                alert('ส่งคำขออัปเดตล้มเหลว');
                            }
                        })
                        .catch(error => {
                            console.error('เกิดข้อผิดพลาด:', error);
                            alert('ส่งคำขออัปเดตล้มเหลว');
                        });
                });
            });
        </script>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                document.getElementById('changeNameButton').addEventListener('click', () => {
                    const formData = new FormData(document.getElementById('changeNameForm'));

                    fetch(document.getElementById('changeNameForm').action, {
                        method: 'POST',
                        body: new URLSearchParams(formData),
                    })
                        .then(response => response.text())
                        .then(result => {
                            // อัพเดตชื่อในหน้าเว็บ
                            const currentNameElement = document.getElementById('currentName');
                            if (currentNameElement) {
                                currentNameElement.textContent = formData.get('name');
                            } else {
                                console.error('ไม่พบ element ที่ชื่อ currentName');
                            }

                            // ล้างฟอร์ม
                            document.getElementById('changeNameForm').reset();

                            // ปิดโมดัล
                            bootstrap.Modal.getInstance(document.getElementById('changeNameModal')).hide();

                            // แสดง Toast
                            const toast = new bootstrap.Toast(document.getElementById('successToast_ChangeName'));
                            toast.show(); // แสดง Toast
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                });
            });
        </script>

        <script>
            function copyToClipboard() {
                // คัดลอกข้อความจาก span ที่มี id เป็น tokenText
                const tokenText = document.getElementById('tokenText').innerText;
                const tempInput = document.createElement('input');
                tempInput.value = tokenText;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);

                // แจ้งเตือนเมื่อคัดลอกสำเร็จ
                alert('Token copied to clipboard: ' + tokenText);
            }
        </script>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const token = '<%= board.token %>'; // ใช้ token ของบอร์ด
                const today = moment().format('YYYY-MM-DD');

                // กำหนด timestamp ปัจจุบันในเขตเวลาที่ต้องการ (เช่น Asia/Bangkok)
                const currentTimestamp = moment().tz('Asia/Bangkok').format('YYYY-MM-DD HH:mm:ss');
                console.log('Current Timestamp:', currentTimestamp);

                // ตั้งค่าเริ่มต้นใน date-picker เป็นวันปัจจุบัน
                document.getElementById('date-picker').value = today;

                // ฟังก์ชันสำหรับการดึงข้อมูล
                let tempChart, phChart;
                function fetchDataForDate(selectedDate) {
                    fetch(`/getHourlyData?token=${token}&date=${selectedDate}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.length === 0) {
                                console.log('No data available');
                                return;
                            }

                            const labels = [];
                            const tempData = [];
                            const pHData = [];
                            const tableBody = document.getElementById('data-table-body');
                            tableBody.innerHTML = ''; // เคลียร์ข้อมูลเก่าก่อน

                            // กรองข้อมูลให้ตรงกับวันที่ที่เลือก
                            const filteredData = data.filter(entry => {
                                const entryDate = moment.utc(entry.timestamp).tz('Asia/Bangkok').format('YYYY-MM-DD');
                                return entryDate === selectedDate; // เปรียบเทียบเฉพาะวันที่
                            });

                            if (filteredData.length === 0) {
                                console.log('No data available for selected date');
                                return;
                            }

                            // อัปเดตวันที่ของข้อมูล
                            const firstEntryDate = new Date(filteredData[0].timestamp);
                            const formattedDate = firstEntryDate.toLocaleDateString('th-TH', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            });

                            // อัปเดตข้อความใน element <p> ที่มี attribute data-date
                            document.querySelectorAll('p[data-date]').forEach(el => {
                                el.textContent = `วันที่ของข้อมูลชุดนี้: ${formattedDate}`;
                            });

                            // คำนวณค่าอุณหภูมิต่ำสุดและสูงสุด
                            const tempValues = filteredData.map(entry => entry.temp);

                            // อัปเดตตารางข้อมูลและกราฟ
                            filteredData.forEach(entry => {
                                // แปลง timestamp จาก UTC เป็นเวลาท้องถิ่น Asia/Bangkok โดยใช้ moment.js
                                const date = moment.utc(entry.timestamp).tz('Asia/Bangkok');

                                labels.push(date.format('HH:mm:ss')); // ใช้ moment เพื่อฟอร์แมตเวลาที่ถูกต้อง
                                tempData.push(entry.temp);
                                pHData.push(entry.ph);

                                // แปลงปี ค.ศ. เป็น พ.ศ.
                                const buddhistYear = date.year() + 543;

                                // ฟอร์แมตวันที่ให้เป็น พ.ศ.
                                const formattedDate = date.format(`DD/MM/${buddhistYear}`);

                                const newRow = document.createElement('tr');
                                newRow.innerHTML = `
                    <td>${formattedDate}</td> <!-- วันที่ -->
                    <td>${date.format('HH:mm:ss')}</td> <!-- เวลา -->
                    <td>${entry.temp}</td>
                    <td>${entry.ph}</td>
                `;
                                tableBody.appendChild(newRow);
                            });

                            // อัปเดตกราฟถ้ายังไม่มีกราฟให้สร้างใหม่แต่ถ้ามีกราฟให้อัพเดต
                            if (!tempChart) {
                                const ctxTemp = document.getElementById('temperatureChart').getContext('2d');
                                tempChart = new Chart(ctxTemp, {
                                    type: 'line',
                                    data: {
                                        labels: labels,
                                        datasets: [{
                                            label: 'Temperature (°C)',
                                            data: tempData,
                                            borderColor: 'rgba(255, 99, 132, 1)',
                                            fill: false
                                        }]
                                    },
                                    options: {
                                        scales: {
                                            y: {
                                                beginAtZero: true
                                            }
                                        }
                                    }
                                });
                            } else {
                                tempChart.data.labels = labels;
                                tempChart.data.datasets[0].data = tempData;
                                tempChart.update();
                            }

                            if (!phChart) {
                                const ctxPH = document.getElementById('pHChart').getContext('2d');
                                phChart = new Chart(ctxPH, {
                                    type: 'line',
                                    data: {
                                        labels: labels,
                                        datasets: [{
                                            label: 'pH',
                                            data: pHData,
                                            borderColor: 'rgba(54, 162, 235, 1)',
                                            fill: false
                                        }]
                                    },
                                    options: {
                                        scales: {
                                            y: {
                                                beginAtZero: true
                                            }
                                        }
                                    }
                                });
                            } else {
                                phChart.data.labels = labels;
                                phChart.data.datasets[0].data = pHData;
                                phChart.update();
                            }
                        });
                }
                // เรียกข้อมูลของวันก่อนหน้าเมื่อตอนโหลดหน้าเว็บ
                fetchDataForDate(today);

                // กดปุ่มเพื่อเลือกวันที่ใหม่
                document.getElementById('fetchDataBtn').addEventListener('click', function () {
                    const selectedDate = document.getElementById('date-picker').value;
                    fetchDataForDate(selectedDate);
                });
            });
        </script>

        <script>
            // สร้างการเชื่อมต่อกับ WebSocket Server
            const socket = new WebSocket('wss://ecprmutiaquarium.azurewebsites.net');  // ใส่พอร์ตของเซิร์ฟเวอร์ที่ใช้

            // เมื่อมีการเชื่อมต่อสำเร็จ
            socket.onopen = function (event) {
                console.log('Connected to WebSocket server');
            };

            // รับข้อมูลจากเซิร์ฟเวอร์
            socket.onmessage = function (event) {
                const boards = JSON.parse(event.data); // รับข้อมูลที่ส่งมาจากเซิร์ฟเวอร์
                boards.forEach(board => {
                    const tempDisplay = document.getElementById(`temp-display-${board.token}`);
                    const phDisplay = document.getElementById(`ph-display-${board.token}`);
                    if (tempDisplay && phDisplay) {
                        tempDisplay.textContent = `${board.temp} °C`;
                        phDisplay.textContent = board.ph;
                    }
                });
            };

            // จัดการเมื่อมีข้อผิดพลาด
            socket.onerror = function (error) {
                console.error('WebSocket error:', error);
            };

            // จัดการเมื่อการเชื่อมต่อถูกปิด
            socket.onclose = function (event) {
                console.log('WebSocket connection closed');
            };
        </script>

</body>

</html>